{"version":3,"sources":["gchart_renderers.coffee"],"names":[],"mappings":"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","file":"gchart_renderers.js","sourceRoot":"/source/","sourcesContent":["callWithJQuery = (pivotModule) ->\r\n    if typeof exports is \"object\" and typeof module is \"object\" # CommonJS\r\n        pivotModule require(\"jquery\")\r\n    else if typeof define is \"function\" and define.amd # AMD\r\n        define [\"jquery\"], pivotModule\r\n    # Plain browser env\r\n    else\r\n        pivotModule jQuery\r\n        \r\ncallWithJQuery ($) ->\r\n\r\n    makeGoogleChart = (chartType, extraOptions) -> (pivotData, opts) ->\r\n        defaults =\r\n            localeStrings:\r\n                vs: \"vs\"\r\n                by: \"by\"\r\n\r\n        opts = $.extend defaults, opts\r\n\r\n        rowKeys = pivotData.getRowKeys()\r\n        rowKeys.push [] if rowKeys.length == 0\r\n        colKeys = pivotData.getColKeys()\r\n        colKeys.push [] if colKeys.length == 0\r\n\r\n        headers = (h.join(\"-\") for h in rowKeys)\r\n        headers.unshift \"\"\r\n\r\n        numCharsInHAxis = 0\r\n        dataArray = [headers]\r\n        for colKey in colKeys\r\n            row = [colKey.join(\"-\")]\r\n            numCharsInHAxis += row[0].length\r\n            for rowKey in rowKeys\r\n                agg = pivotData.getAggregator(rowKey, colKey)\r\n                if agg.value()?\r\n                    row.push agg.value()\r\n                else row.push null\r\n            dataArray.push row\r\n\r\n        title = vAxisTitle = pivotData.aggregatorName+ \r\n            if pivotData.valAttrs.length then \"(#{pivotData.valAttrs.join(\", \")})\" else \"\"\r\n        hAxisTitle = pivotData.colAttrs.join(\"-\")\r\n        title += \" #{opts.localeStrings.vs} #{hAxisTitle}\" if hAxisTitle != \"\"\r\n        groupByTitle = pivotData.rowAttrs.join(\"-\")\r\n        title += \" #{opts.localeStrings.by} #{groupByTitle}\" if groupByTitle != \"\"\r\n\r\n        options = \r\n            width: $(window).width() / 1.4\r\n            height: $(window).height() / 1.4\r\n            title: title\r\n            hAxis: {title: hAxisTitle, slantedText: numCharsInHAxis > 50}\r\n            vAxis: {title: vAxisTitle}\r\n\r\n        if dataArray[0].length == 2 and dataArray[0][1] ==  \"\"\r\n            options.legend = position: \"none\"\r\n\r\n        options[k] = v for k, v of extraOptions\r\n\r\n        dataTable = google.visualization.arrayToDataTable(dataArray)\r\n\r\n        result = $(\"<div>\").css(width: \"100%\", height: \"100%\")\r\n        wrapper = new google.visualization.ChartWrapper {dataTable, chartType, options}\r\n        wrapper.draw(result[0])    \r\n        result.bind \"dblclick\", -> \r\n            editor = new google.visualization.ChartEditor()\r\n            google.visualization.events.addListener editor, 'ok', -> \r\n                editor.getChartWrapper().draw(result[0])\r\n            editor.openDialog(wrapper)\r\n        return result\r\n\r\n    $.pivotUtilities.gchart_renderers = \r\n        \"Line Chart\": makeGoogleChart(\"LineChart\")\r\n        \"Bar Chart\": makeGoogleChart(\"ColumnChart\")\r\n        \"Stacked Bar Chart\": makeGoogleChart(\"ColumnChart\", isStacked: true)\r\n        \"Area Chart\": makeGoogleChart(\"AreaChart\", isStacked: true)\r\n"]}